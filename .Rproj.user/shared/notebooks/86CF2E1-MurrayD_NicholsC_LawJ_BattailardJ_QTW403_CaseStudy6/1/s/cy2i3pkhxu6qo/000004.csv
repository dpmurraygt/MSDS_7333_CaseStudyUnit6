"0","#This is the code from Nolan and Lang Chapter 1"
"0","options(digits = 2)"
"0","#setwd('~/DataScience/SMU_Data_Science/MSDS_QTW/MSDS_7333_CaseStudyUnit6/')"
"0","# Read in the text file to a matrix called txt"
"0","txt = readLines(""Data/offline.final.trace.txt"")"
"0","# get a count of lines that have a # in the first character location "
"0","sum(substr(txt, 1, 1) == ""#"")"
"1","[1]"
"1"," 5312"
"1","
"
"0","# total lines in the txt matrix"
"0","length(txt)"
"1","[1]"
"1"," 151392"
"1","
"
"0","# as a test, strsplit the 4th line on semicolons, print to screen"
"0","strsplit(txt[4], "";"")[[1]]"
"1"," [1]"
"1"," ""t=1139643118358""                   "
"1"," ""id=00:02:2D:21:0F:33""              "
"1"," ""pos=0.0,0.0,0.0""                   "
"1","
"
"1"," [4]"
"1"," ""degree=0.0""                        "
"1"," ""00:14:bf:b1:97:8a=-38,2437000000,3"""
"1"," ""00:14:bf:b1:97:90=-56,2427000000,3"""
"1","
"
"1"," [7]"
"1"," ""00:0f:a3:39:e1:c0=-53,2462000000,3"""
"1"," ""00:14:bf:b1:97:8d=-65,2442000000,3"""
"1"," ""00:14:bf:b1:97:81=-65,2422000000,3"""
"1","
"
"1","[10]"
"1"," ""00:14:bf:3b:c7:c6=-66,2432000000,3"""
"1"," ""00:0f:a3:39:dd:cd=-75,2412000000,3"""
"1"," ""00:0f:a3:39:e0:4b=-78,2462000000,3"""
"1","
"
"1","[13]"
"1"," ""00:0f:a3:39:e2:10=-87,2437000000,3"""
"1"," ""02:64:fb:68:52:e6=-88,2447000000,1"""
"1"," ""02:00:42:55:31:00=-84,2457000000,1"""
"1","
"
"0","# store results of string of the 4th line to a vector"
"0","tokens = strsplit(txt[4], ""[;=,]"")[[1]]"
"0","# print tokens 1:10 to screen"
"0","tokens[1:10]"
"1"," [1]"
"1"," ""t""                "
"1"," ""1139643118358""    "
"1"," ""id""               "
"1"," ""00:02:2D:21:0F:33"""
"1"," ""pos""              "
"1"," ""0.0""              "
"1","
"
"1"," [7]"
"1"," ""0.0""              "
"1"," ""0.0""              "
"1"," ""degree""           "
"1"," ""0.0""              "
"1","
"
"0","# extract the 2nd, 4th, 6:8 and 10th elements to the screen"
"0","# these tokens make up the handheld device"
"0","tokens[c(2, 4, 6:8, 10)]"
"1","[1]"
"1"," ""1139643118358""    "
"1"," ""00:02:2D:21:0F:33"""
"1"," ""0.0""              "
"1"," ""0.0""              "
"1"," ""0.0""              "
"1"," ""0.0""              "
"1","
"
"0","# get features for readings (all else not == handheld device)"
"0","tokens[ - ( 1:10 ) ]"
"1"," [1]"
"1"," ""00:14:bf:b1:97:8a"""
"1"," ""-38""              "
"1"," ""2437000000""       "
"1"," ""3""                "
"1"," ""00:14:bf:b1:97:90"""
"1"," ""-56""              "
"1","
"
"1"," [7]"
"1"," ""2427000000""       "
"1"," ""3""                "
"1"," ""00:0f:a3:39:e1:c0"""
"1"," ""-53""              "
"1"," ""2462000000""       "
"1"," ""3""                "
"1","
"
"1","[13]"
"1"," ""00:14:bf:b1:97:8d"""
"1"," ""-65""              "
"1"," ""2442000000""       "
"1"," ""3""                "
"1"," ""00:14:bf:b1:97:81"""
"1"," ""-65""              "
"1","
"
"1","[19]"
"1"," ""2422000000""       "
"1"," ""3""                "
"1"," ""00:14:bf:3b:c7:c6"""
"1"," ""-66""              "
"1"," ""2432000000""       "
"1"," ""3""                "
"1","
"
"1","[25]"
"1"," ""00:0f:a3:39:dd:cd"""
"1"," ""-75""              "
"1"," ""2412000000""       "
"1"," ""3""                "
"1"," ""00:0f:a3:39:e0:4b"""
"1"," ""-78""              "
"1","
"
"1","[31]"
"1"," ""2462000000""       "
"1"," ""3""                "
"1"," ""00:0f:a3:39:e2:10"""
"1"," ""-87""              "
"1"," ""2437000000""       "
"1"," ""3""                "
"1","
"
"1","[37]"
"1"," ""02:64:fb:68:52:e6"""
"1"," ""-88""              "
"1"," ""2447000000""       "
"1"," ""1""                "
"1"," ""02:00:42:55:31:00"""
"1"," ""-84""              "
"1","
"
"1","[43]"
"1"," ""2457000000""       "
"1"," ""1""                "
"1","
"
"0","# assign a matrix of everything except elements 1:10 to a 4 coloumn matrix called tmp"
"0","# build a matrix for each section of the data and bind them together using cbind"
"0","tmp = matrix(tokens[ - (1:10) ], ncol = 4, byrow = TRUE) # get all signals"
"0","mat = cbind(matrix(tokens[c(2, 4, 6:8, 10)], nrow = nrow(tmp), # repeat handheld device data"
"0","                   ncol = 6, byrow = TRUE), "
"0","            tmp)"
"0","#print shape of mat to screen"
"0","dim(mat)"
"1","[1]"
"1"," 11"
"1"," 10"
"1","
"
"0","# make this extendable, create function to repeat process for each line in dataset"
"0","# this will create individual matrices for each line in the data (not efficient)"
"0","processLine ="
"0","function(x)"
"0","{"
"0","  tokens = strsplit(x, ""[;=,]"")[[1]]"
"0","  tmp = matrix(tokens[ - (1:10) ], ncol = 4, byrow = TRUE)"
"0","  cbind(matrix(tokens[c(2, 4, 6:8, 10)], nrow = nrow(tmp),"
"0","               ncol = 6, byrow = TRUE), tmp)"
"0","}"
"0","# apply to 17 lines of first file at x,y = 0,0 and pos = 0.0"
"0","# creates 17 matrices, returns them in a list"
"0","tmp = lapply(txt[4:20], processLine)"
"0","# count the number of records in each matrix created"
"0","# use sapply (preserves dimensions tmp) to show the number of rows in each row in tmp"
"0","sapply(tmp, nrow)"
"1"," [1]"
"1"," 11"
"1"," 10"
"1"," 10"
"1"," 11"
"1","  9"
"1"," 10"
"1","  9"
"1","  9"
"1"," 10"
"1"," 11"
"1"," 11"
"1","  9"
"1","  9"
"1","  9"
"1","  8"
"1"," 10"
"1"," 14"
"1","
"
"0","# stack the matrices using rbind and do.call"
"0","offline = as.data.frame(do.call(""rbind"", tmp))"
"0","dim(offline)"
"1","[1]"
"1"," 170"
"1","  10"
"1","
"
"0","# now do this for the entire dataset"
"0","# create a list called lines that contains the lines that don't start with a # "
"0","lines = txt[ substr(txt, 1, 1) != ""#"" ]"
"0","tmp = lapply(lines, processLine)"
"2","data length exceeds size of matrix"
"2","data length exceeds size of matrix"
"2","data length exceeds size of matrix"
"2","data length exceeds size of matrix"
"2","data length exceeds size of matrix"
"2","data length exceeds size of matrix"
"0","# adjust induction function for issue where no readings for a position x,y and orientation"
"0","# discard if we only find tokens for handheld device"
"0","processLine = function(x)"
"0","{"
"0","  tokens = strsplit(x, ""[;=,]"")[[1]]"
"0","  "
"0","  if (length(tokens) == 10)  # this is the adjustment, checks to see if we have signal responses, if not, returns null"
"0","    return(NULL)"
"0"," "
"0","  tmp = matrix(tokens[ - (1:10) ], ncol= 4, byrow = TRUE)"
"0","  cbind(matrix(tokens[c(2, 4, 6:8, 10)], nrow(tmp), 6, "
"0","               byrow = TRUE), tmp)"
"0","}"
"0","options(error = recover, warn = 1)"
"0","tmp = lapply(lines, processLine)"
"0","offline = as.data.frame(do.call(""rbind"", tmp), "
"0","                        stringsAsFactors = FALSE)"
"0","# offline dataframe in tidy format with readings down instead of across"
"0","dim(offline)"
"1","[1]"
"1"," 1181628"
"1","      10"
"1","
"
"0","# clean data and build represenation for analysis"
"0","# rename the columns, transform numeric values"
"0","names(offline) = c(""time"", ""scanMac"", ""posX"", ""posY"", ""posZ"", "
"0","                   ""orientation"", ""mac"", ""signal"", "
"0","                   ""channel"", ""type"")"
"0","numVars = c(""time"", ""posX"", ""posY"", ""posZ"", "
"0","            ""orientation"", ""signal"")"
"0","offline[ numVars ] =  lapply(offline[ numVars ], as.numeric)"
"0","# drop all vars with 1 as mode and remove type variable"
"0","# only want to keep access point (type 3)"
"0","offline = offline[ offline$type == ""3"", ]"
"0","offline = offline[ , ""type"" != names(offline) ] # this filters out type from columns"
"0","dim(offline)"
"1","[1]"
"1"," 978443"
"1","      9"
"1","
"
"0","# transform time from ms to s in order to get POSIXt format"
"0","offline$rawTime = offline$time"
"0","offline$time = offline$time/1000 # convert from ms to s"
"0","class(offline$time) = c(""POSIXt"", ""POSIXct"")"
"0","# check the class of each variable in our dataset"
"0","unlist(lapply(offline, class))"
"1","      time1 "
"1","      time2 "
"1","    scanMac "
"1","       posX "
"1","       posY "
"1","       posZ "
"1","orientation "
"1","        mac "
"1","     signal "
"1","    channel "
"1","    rawTime "
"1","
"
"1","   ""POSIXt"" "
"1","  ""POSIXct"" "
"1","""character"" "
"1","  ""numeric"" "
"1","  ""numeric"" "
"1","  ""numeric"" "
"1","  ""numeric"" "
"1","""character"" "
"1","  ""numeric"" "
"1","""character"" "
"1","  ""numeric"" "
"1","
"
"0","# summary stats on our numeric vars"
"0","summary(offline[, numVars])"
"1","      time                    "
"1","      posX   "
"1","      posY     "
"1","      posZ  "
"1","  orientation "
"1","     signal   "
"1","
"
"1"," Min.   :2006-02-11 02:31:58  "
"1"," Min.   : 0  "
"1"," Min.   : 0.0  "
"1"," Min.   :0  "
"1"," Min.   :  0  "
"1"," Min.   :-99  "
"1","
"
"1"," 1st Qu.:2006-02-11 08:21:27  "
"1"," 1st Qu.: 2  "
"1"," 1st Qu.: 3.0  "
"1"," 1st Qu.:0  "
"1"," 1st Qu.: 90  "
"1"," 1st Qu.:-69  "
"1","
"
"1"," Median :2006-02-11 14:57:58  "
"1"," Median :12  "
"1"," Median : 6.0  "
"1"," Median :0  "
"1"," Median :180  "
"1"," Median :-60  "
"1","
"
"1"," Mean   :2006-02-16 09:57:37  "
"1"," Mean   :14  "
"1"," Mean   : 5.9  "
"1"," Mean   :0  "
"1"," Mean   :167  "
"1"," Mean   :-62  "
"1","
"
"1"," 3rd Qu.:2006-02-19 09:52:40  "
"1"," 3rd Qu.:23  "
"1"," 3rd Qu.: 8.0  "
"1"," 3rd Qu.:0  "
"1"," 3rd Qu.:270  "
"1"," 3rd Qu.:-53  "
"1","
"
"1"," Max.   :2006-03-09 15:41:10  "
"1"," Max.   :33  "
"1"," Max.   :13.0  "
"1"," Max.   :0  "
"1"," Max.   :360  "
"1"," Max.   :-25  "
"1","
"
"0","# only one MAC for our scanning device: 00:02:2D:21:0F:33"
"0","summary(sapply(offline[ , c(""mac"", ""channel"", ""scanMac"")],"
"0","                as.factor))"
"1","                mac        "
"1","       channel      "
"1","              scanMac      "
"1","
"
"1"," 00:0f:a3:39:e1:c0:145862  "
"1"," 2462000000:189774  "
"1"," 00:02:2D:21:0F:33:978443  "
"1","
"
"1"," 00:0f:a3:39:dd:cd:145619  "
"1"," 2437000000:152124  "
"1","                           "
"1","
"
"1"," 00:14:bf:b1:97:8a:132962  "
"1"," 2412000000:145619  "
"1","                           "
"1","
"
"1"," 00:14:bf:3b:c7:c6:126529  "
"1"," 2432000000:126529  "
"1","                           "
"1","
"
"1"," 00:14:bf:b1:97:90:122315  "
"1"," 2427000000:122315  "
"1","                           "
"1","
"
"1"," 00:14:bf:b1:97:8d:121325  "
"1"," 2442000000:121325  "
"1","                           "
"1","
"
"1"," (Other)          :183831  "
"1"," (Other)   :120757  "
"1","                           "
"1","
"
"0","# remove scanMac and posZ from offline df: no posZ in data and only one scanMac"
"0","offline = offline[ , !(names(offline) %in% c(""scanMac"", ""posZ""))]"
"0","# exploring orientation, far more than 8 values for orientation"
"0","length(unique(offline$orientation))"
"1","[1]"
"1"," 203"
"1","
"
"0","# values distributed in clusters around what we'd expect"
"0","plot(ecdf(offline$orientation))"
